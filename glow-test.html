<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safari Glow Filter Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1f2121;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        .test-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            flex-wrap: wrap;
        }
        
        .test-item {
            position: relative;
            width: 200px;
            height: 200px;
            border: 2px solid #7ae3fc;
            background: rgba(122, 227, 252, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px;
        }
        
        .svg-glow-test svg {
            width: 150px;
            height: 150px;
        }
        
        .css-glow-test {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }
        
        /* CSS-based glow for Safari */
        .css-glow {
            filter: drop-shadow(0 0 6px #7ae3fc) drop-shadow(0 0 10px #7ae3fc);
            text-shadow: 0 0 8px #7ae3fc, 0 0 12px #7ae3fc;
        }
        
        /* Safari-specific styles */
        @supports (-webkit-touch-callout: none) {
            .svg-glow-test [filter*="glow"] {
                filter: drop-shadow(0 0 6px #7ae3fc) !important;
            }
            
            .svg-glow-test defs filter {
                display: none !important;
            }
        }
        
        .label {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #7ae3fc;
            text-align: center;
            width: 100%;
        }
        
        .debug-info {
            margin-top: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: rgba(122, 227, 252, 0.1);
            border-radius: 8px;
            border: 1px solid #7ae3fc;
        }
    </style>
</head>
<body>
    <h1>Safari Glow Filter Compatibility Test</h1>
    
    <div class="test-container">
        <!-- Original SVG Filter Test -->
        <div class="test-item svg-glow-test">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <defs>
                    <filter id="testGlow" x="-200%" y="-200%" width="400%" height="400%">
                        <feGaussianBlur stdDeviation="3" result="blur" />
                        <feFlood flood-color="#7ae3fc" flood-opacity="1" result="sharp" />
                        <feComposite in="sharp" in2="SourceGraphic" operator="in" result="sharpStroke" />
                        <feMerge>
                            <feMergeNode in="blur" />
                            <feMergeNode in="sharpStroke" />
                        </feMerge>
                    </filter>
                </defs>
                <circle cx="50" cy="50" r="30" fill="none" stroke="#7ae3fc" stroke-width="2" filter="url(#testGlow)"/>
                <rect x="20" y="20" width="60" height="60" fill="none" stroke="#7ae3fc" stroke-width="2" filter="url(#testGlow)"/>
            </svg>
            <div class="label">Original SVG Filter</div>
        </div>
        
        <!-- CSS Drop-Shadow Test -->
        <div class="test-item css-glow-test">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="30" fill="none" stroke="#7ae3fc" stroke-width="2" 
                        style="filter: drop-shadow(0 0 6px #7ae3fc);"/>
                <rect x="20" y="20" width="60" height="60" fill="none" stroke="#7ae3fc" stroke-width="2" 
                      style="filter: drop-shadow(0 0 6px #7ae3fc);"/>
            </svg>
            <div class="label">CSS Drop-Shadow</div>
        </div>
        
        <!-- Text Glow Test -->
        <div class="test-item css-glow-test css-glow">
            <div>
                TEXT<br>
                GLOW<br>
                TEST
            </div>
            <div class="label">CSS Text Glow</div>
        </div>
        
        <!-- Mixed Test -->
        <div class="test-item svg-glow-test" id="mixedTest">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <defs>
                    <filter id="mixedGlow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="2" in="SourceGraphic" result="blur" />
                        <feOffset dx="0" dy="0" in="blur" result="offset" />
                        <feMerge>
                            <feMergeNode in="offset" />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                </defs>
                <circle cx="50" cy="50" r="25" fill="#7ae3fc" opacity="0.3" filter="url(#mixedGlow)"/>
                <path d="M30,50 L50,30 L70,50 L50,70 Z" fill="none" stroke="#7ae3fc" stroke-width="2" filter="url(#mixedGlow)"/>
            </svg>
            <div class="label">Safari-Compatible Filter</div>
        </div>
    </div>
    
    <div class="debug-info">
        <h3>Browser Information:</h3>
        <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
        <p><strong>Is Safari:</strong> <span id="isSafari"></span></p>
        <p><strong>Supports Complex Filters:</strong> <span id="supportsFilters"></span></p>
    </div>
    
    <div class="test-results">
        <h3>Test Results:</h3>
        <div id="testResults"></div>
    </div>
    
    <script>
        // Debug information
        document.getElementById('userAgent').textContent = navigator.userAgent;
        
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        document.getElementById('isSafari').textContent = isSafari ? 'YES' : 'NO';
        
        // Test for filter support
        const testSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        const testRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        testRect.setAttribute('filter', 'url(#testFilter)');
        testSvg.appendChild(testRect);
        document.body.appendChild(testSvg);
        
        const supportsComplexFilters = getComputedStyle(testRect).filter !== 'none';
        document.getElementById('supportsFilters').textContent = supportsComplexFilters ? 'YES' : 'NO';
        document.body.removeChild(testSvg);
        
        // Apply Safari fixes if needed
        if (isSafari) {
            console.log('Safari detected - applying glow filter fixes');
            
            // Disable complex SVG filters
            const complexFilters = document.querySelectorAll('defs filter[id="testGlow"]');
            complexFilters.forEach(filter => {
                console.log('Disabling complex filter for Safari');
                filter.style.display = 'none';
            });
            
            // Replace with CSS-based effects
            const glowElements = document.querySelectorAll('[filter*="testGlow"]');
            glowElements.forEach(el => {
                console.log('Replacing SVG filter with CSS drop-shadow');
                el.style.filter = 'drop-shadow(0 0 6px #7ae3fc) drop-shadow(0 0 10px #7ae3fc)';
                el.removeAttribute('filter');
            });
            
            document.getElementById('testResults').innerHTML = `
                <p>✅ Safari compatibility mode activated</p>
                <p>✅ Complex SVG filters disabled</p>
                <p>✅ CSS drop-shadow fallbacks applied</p>
                <p>✅ Text glow effects preserved</p>
            `;
        } else {
            document.getElementById('testResults').innerHTML = `
                <p>ℹ️ Non-Safari browser detected</p>
                <p>ℹ️ Using original SVG filters</p>
                <p>ℹ️ No compatibility fixes needed</p>
            `;
        }
        
        // Test visibility after delay
        setTimeout(() => {
            const testItems = document.querySelectorAll('.test-item');
            let visibleCount = 0;
            
            testItems.forEach((item, index) => {
                const rect = item.getBoundingClientRect();
                const isVisible = rect.width > 0 && rect.height > 0 && 
                                 getComputedStyle(item).display !== 'none' &&
                                 getComputedStyle(item).visibility !== 'hidden';
                
                if (isVisible) visibleCount++;
                
                console.log(`Test item ${index + 1} visibility:`, isVisible);
            });
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML += `<p><strong>Visible test items:</strong> ${visibleCount}/${testItems.length}</p>`;
            
            if (visibleCount < testItems.length) {
                resultsDiv.innerHTML += `<p style="color: #ff6b6b;">⚠️ Some test items are not visible!</p>`;
            } else {
                resultsDiv.innerHTML += `<p style="color: #51cf66;">✅ All test items are visible!</p>`;
            }
        }, 1000);
    </script>
</body>
</html>
